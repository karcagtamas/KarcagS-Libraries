@page "/table"
@using KarcagS.Blazor.Common.Components.Table.Styles
@using KarcagS.Blazor.Common.Demo.Services
@using KarcagS.Shared.Enums
@inject IDemoTableService Service

<div class="flex-box overflow-hidden p-1">
    <Table @ref="Table" TKey="string" Service="Service" TableStyle="Style" InitialParams="ExtraParams"
           OnRowClick="@RowClickHandler" OnAction="@ActionHandler">

        <FilterRow>
            <MudTextField Style="width: 220px;" T="string" Label="Text Filter" Variant="Variant.Outlined"
                          Margin="Margin.Dense"
                          TextChanged="@(arg => context.SetAdditionalFilter("text", string.IsNullOrEmpty(arg) ? null : arg))"/>
        </FilterRow>

    </Table>
</div>

@code {
    private Table<string>? Table { get; set; }

    private StyleConfiguration Style { get; set; } = StyleConfiguration.Build()
        .AddColumnStyleGetter(colKey =>
        {
            var builder = ColumnStyleBuilder.Init()
                .TitleColor(colKey == "id" ? Color.Primary : Color.Secondary);

            switch (colKey)
            {
                case "id":
                    builder.Width(80);
                    builder.TextAlignment(Alignment.Center);
                    break;
                case "age":
                    builder.Width(50);
                    builder.TextAlignment(Alignment.Right);
                    break;
                case "date":
                    builder.Width(200);
                    break;
                case "gender" or "other":
                    builder.Width(120);
                    break;
            }

            return builder.Build();
        })
        .AddCellStyleGetter((_, item) =>
        {
            var builder = CellStyleBuilder.Init();

            if (item.Tags.Contains("TRUE_VALUE"))
            {
                builder.TextColor(Color.Success);
            }
            else if (item.Tags.Contains("FALSE_VALUE"))
            {
                builder.TextColor(Color.Error);
            }

            if (item.Value == "open")
            {
            }

            builder.Icon(item.Value == "open" ? Icons.Material.Filled.OpenWith : Icons.Material.Filled.Info);
            builder.IconColor(item.Value == "open" ? Color.Error : Color.Default);

            return builder.Build();
        });

    private Dictionary<string, object> ExtraParams { get; set; } = new()
    {
        { "key", 1 }
    };

    private void RowClickHandler(TableRowClickArgs<TableRowItem<string>> item)
    {
        // var items = Table?.GetData();
        Console.WriteLine(item.Item.ItemKey);
        Console.WriteLine(item.IsDoubleClick);
        Console.WriteLine(item.Button.ToString());
    }

    private void ActionHandler(KeyValuePair<string, TableRowItem<string>> pair)
    {
        Console.WriteLine(pair.Key);
    }

}