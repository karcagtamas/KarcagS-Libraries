@page "/table"
@using KarcagS.Blazor.Common.Demo.Services
@using KarcagS.Shared.Table
@inject IDemoTableService Service

<div class="flex-box overflow-hidden p-1">
    <Table @ref="Table" TKey="string" Service="Service" Style="Style" InitialParams="ExtraParams" OnRowClick="RowClickHandler" OnAction="ActionHandler">

        <FilterRow>
            <MudTextField Style="width: 220px;" T="string" Label="Text Filter" Variant="Variant.Outlined" Margin="Margin.Dense" TextChanged="@((arg) => context("text", string.IsNullOrEmpty(arg) ? null : arg))"/>
        </FilterRow>

    </Table>
</div>

@code {
    private Table<string>? Table { get; set; }

    private StyleConfiguration Style { get; set; } = StyleConfiguration.Build()
        .AddTitleColorGetter(colKey => colKey == "id" ? Color.Primary : Color.Secondary)
        .AddColorGetter(item =>
        {
            if (item.Tags.Contains("TRUE_VALUE"))
            {
                return Color.Success;
            }

            if (item.Tags.Contains("FALSE_VALUE"))
            {
                return Color.Error;
            }

            return Color.Default;
        })
        .AddIconGetter(item => item.Value == "open" ? Icons.Material.Filled.OpenWith : Icons.Material.Filled.Info)
        .AddIconColorGetter(item => item.Value == "open" ? Color.Error : Color.Default);

    private Dictionary<string, object> ExtraParams { get; set; } = new()
    {
        { "key", 1 }
    };

    private void RowClickHandler(ResultRowItem<string> item)
    {
        var items = Table?.GetData();
        Console.WriteLine(item.ItemKey);
    }

    private void ActionHandler(KeyValuePair<string, ResultRowItem<string>> pair)
    {
        Console.WriteLine(pair.Key);
    }

}